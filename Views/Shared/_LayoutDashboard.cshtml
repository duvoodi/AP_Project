@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="fa">
<head>
  <!-- شروع به کار اسکریپت چک متوالی سشن بلافاصله بعد لود هد -->
  <script>
    setInterval(() => {
      fetch('/Login/CheckSession?hashed=true', { cache: 'no-store' })
      .then(res => res.json())
      .then(data => {
          const role = data.role;
          const sessionHash = data.id;
          if (role === 'none') {
            window.location.href = '/Login/Index';
            return;
          }
          const currentHash = (new URLSearchParams(window.location.search)).get('h');
          if (currentHash !== sessionHash) {
            window.location.href = '/Login/Index';
            return;
          }
      })
      .catch(() => {
          window.location.href = '/Login/Index';
      });
    }, 5000); // هر 5 ثانیه تا فشار به سرور نیاد
    // این هر چند ثانیه چک میکند که هش سشن صفحه با هش سشن فعال یکی باشد
    // اگر متفاوت باشد سشن این صفحه منقضی شده و به صفحه لاگین میرود
    // اونجا اگر سشن فعال داریم به داشبوردش میرود اگر نداریم صفحه لاگین لود میشود
  </script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>@ViewData["Title"]</title>
  @RenderSection("Styles", required: false)
</head>
<body>
  @RenderSection("Header", required: true)
  <main class="main">
    @RenderBody()
    @RenderSection("Scripts", required: false)
  </main>
</body>
</html>

<script>
  // بعد از لود موارد بالا یعنی بعد از لود تمام موارد صفحه، داشبورد مین و فوتر را نمایان میکنیم
  // در سی اس اس سراسری داشبورد برای ویزیبل شدن داشبورد مین و داشبورد فوتر انیمیشن زدیم
  window.addEventListener('load', () => {
    const elements = document.querySelectorAll('.dashboard-main, .dashboard-footer');
    elements.forEach(el => {
      el.classList.add('visible');
    });
    // بعد نمایش مین و فوتر پاپ آپ و مواردی که با تاخیر باید نمایان شوند و کلاس ویل شو دارن نمایش داده میشوند
    setTimeout(() => {
      const willShowPopups = document.querySelectorAll('.will-show');
      willShowPopups.forEach(el => {
        el.classList.add('visible');
      });
    }, 500); // با تأخیر 500 میلی ثانیه ای نمایان میشوند
  });
</script>