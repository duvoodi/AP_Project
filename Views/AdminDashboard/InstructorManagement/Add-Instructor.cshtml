@model AP_Project.Models.Users.Instructor
@{
  ViewData["Title"] = "افزودن استاد جدید";
  Layout = "_LayoutAdmin";
  ViewData["ActiveTab"] = "Instructor";
  var hasFooter = false;
  var hashedId = ViewData["HashedId"] as string ?? "";
}

<!-- استایل اختصاصی -->
<link rel="stylesheet" href="~/css/AdminDashboard/InstructorManagement/Add-Instructor.css" asp-append-version="true" />

<main class="admin-main @(hasFooter ? "has-footer" : "has-not-footer")">
  <div class="form-container">
    <div class="add-instructor-tab">
      افزودن استاد
    </div>
    <form asp-action="AddInstructor" asp-controller="InstructorManagement" method="post" id="add-instructor-form">
      <input type="hidden" name="h" value="@hashedId" />

      <div class="form-row">
        <div class="form-group">
          <label asp-for="FirstName">نام</label>
          <input asp-for="FirstName" class="form-control" id="FirstName" name="FirstName" />
          <span asp-validation-for="FirstName" class="error-message"></span>
        </div>
        <div class="form-group">
          <label asp-for="LastName">نام خانوادگی</label>
          <input asp-for="LastName" class="form-control" id="LastName" name="LastName" />
          <span asp-validation-for="LastName" class="error-message"></span>
        </div>
        <div class="form-group">
          <label asp-for="Email">ایمیل</label>
          <input asp-for="Email" class="form-control" id="Email" name="Email" />
          <span asp-validation-for="Email" class="error-message"></span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label asp-for="InstructorId">کد مدرسی</label>
          <input asp-for="InstructorId" class="form-control" readonly style="background:#f3f3f3;color:#888;" />
          <span asp-validation-for="InstructorId" class="error-message"></span>
        </div>
        <div class="form-group">
          <label asp-for="Salary">میزان حقوق (تومان)</label>
          <input asp-for="Salary" type="number" class="form-control" id="Salary" name="Salary" />
          <span asp-validation-for="Salary" class="error-message"></span>
        </div>
        <div class="form-group">
          <label asp-for="HireYear">سال استخدام</label>
          <input asp-for="HireYear" type="number" class="form-control" id="HireYear" name="HireYear" />
          <span asp-validation-for="HireYear" class="error-message"></span>
        </div>
      </div>

      <div class="form-row">
        <div class="form-group">
          <label asp-for="HashedPassword">رمز عبور</label>
          <input asp-for="HashedPassword" type="password" class="form-control" id="Password" name="HashedPassword" />
          <span asp-validation-for="HashedPassword" class="error-message"></span>
        </div>
        <div class="form-group">
          <label for="ConfirmPassword">تکرار رمز عبور</label>
          <input type="password" class="form-control" id="ConfirmPassword" name="ConfirmPassword" />
          <span id="confirm-password-error" class="error-message"></span>
        </div>
      </div>

      <div class="form-actions">
        <button type="button" class="btn-cancel">انصراف</button>
        <button type="submit" class="btn-submit">تایید</button>
      </div>
    </form>
  </div>
</main>

@section Scripts {
  <partial name="_ValidationScriptsPartial" />
  <script>
    document.getElementById('add-instructor-form').addEventListener('submit', function (e) {
      // پاک کردن خطاهای قبلی
      document.querySelectorAll('.error-message').forEach(span => span.textContent = '');

      var pass = document.getElementById('Password').value.trim();
      var confirm = document.getElementById('ConfirmPassword').value.trim();
      var hasError = false;

      // لیست فیلدهای ضروری با نام و id که توی فرم استفاده شده
      var requiredFields = [
        { id: 'FirstName', name: 'نام' },
        { id: 'LastName', name: 'نام خانوادگی' },
        { id: 'Email', name: 'ایمیل' },
        { id: 'HireYear', name: 'سال استخدام' },
        { id: 'Salary', name: 'میزان حقوق' },
        { id: 'Password', name: 'رمز عبور' },
        { id: 'ConfirmPassword', name: 'تکرار رمز عبور' }
      ];

      requiredFields.forEach(function (field) {
        var input = document.getElementById(field.id);
        if (!input || input.value.trim() === '') {
          var span = input ? input.nextElementSibling : null;
          if (span && span.classList.contains('error-message')) {
            span.textContent = `لطفاً ${field.name} را وارد کنید`;
          }
          hasError = true;
        }
      });

      // چک کردن تطابق رمز عبور و تکرارش
      if (pass !== confirm) {
        var errorSpan = document.getElementById('confirm-password-error');
        errorSpan.textContent = 'رمز عبور و تکرار آن یکسان نیستند';
        hasError = true;
      }

      if (hasError) {
        e.preventDefault(); // جلوگیری از ارسال فرم
      }
    });

    // انصراف: بازگشت به صفحه قبل
    document.querySelector('.btn-cancel').onclick = function () {
      history.back();
    };
  </script>
}
